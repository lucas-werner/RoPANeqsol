<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoPA Training Game</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap");
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Inter",sans-serif;background:#f4f7fa;color:#333;padding:20px;min-height:100vh;position:relative}
    #logoLeft,#logoRight{position:fixed;top:20px;width:80px;opacity:.9;z-index:1000}
    #logoLeft{left:20px}#logoRight{right:20px}
    h1{text-align:center;font-weight:600;color:#1a202c;margin:60px 0 40px}
    .scenario{background:#fff;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.05);padding:20px;margin-bottom:30px}
    .hidden{display:none}
    h2{color:#2d3748;font-weight:600;margin-bottom:8px}
    p{color:#4a5568;line-height:1.6;margin-bottom:14px}
    table{width:100%;border-collapse:collapse;margin-bottom:20px}
    th,td{border:1px solid #e2e8f0;padding:12px 10px;min-height:60px;text-align:center;vertical-align:middle}
    th{background:#edf2f7;color:#2d3748;font-weight:600;position:relative}
    .q{display:inline-block;background:#3182ce;color:#fff;border-radius:50%;width:18px;height:18px;line-height:18px;font-size:12px;text-align:center;margin-left:6px;cursor:help;position:relative}
    .q:hover::after{content:attr(data-tip);position:absolute;bottom:-6px;left:50%;transform:translate(-50%,100%);background:#2d3748;color:#fff;padding:6px 8px;font-size:12px;border-radius:4px;white-space:nowrap;z-index:2000}
    .q:hover::before{content:"";position:absolute;bottom:2px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#2d3748;z-index:2000}
    .dropzone{background:#fafafa;transition:background .3s}
    .dropzone.blue{background:#bee3f8}.dropzone.red{background:#feb2b2}
    .drag-container{display:flex;flex-wrap:wrap;gap:10px;padding:15px;background:#f7fafc;border:2px dashed #cbd5e0;border-radius:6px;min-height:100px}
    .drag-item{background:#3182ce;color:#fff;padding:8px 12px;border-radius:20px;cursor:grab;font-size:14px;user-select:none;transition:transform .1s}
    .drag-item:active{transform:scale(.95);opacity:.8}
    input.answer{width:100%;border:none;background:#f0f4f8;height:100%;padding:6px;text-align:center}
    .answerKey{display:none;margin-top:20px}
    #navBtnWrap{display:flex;justify-content:center;gap:20px;margin:40px 0}
    .navBtn{padding:12px 24px;font-size:16px;background:#2b6cb0;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background .3s}
    .navBtn:hover{background:#2c5282}.navBtn:disabled{background:#a0aec0;cursor:not-allowed}
  </style>
</head>
<body>
  <img id="logoLeft" src="https://www.adfiz.nl/media/4184/dpo-logo-vierkant.jpg" alt="DPO logo" />
  <img id="logoRight" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRcu6Z6Jlam0yLD96hF_kjUoImUcCequQZ8Kw&s" alt="Game logo" />

  <h1>RoPA Practice – Payroll & HR Scenarios</h1>

  <!-- Header template with System and Security measures -->
  <template id="theadTpl">
    <thead><tr>
      <th>Department<span class="q" data-tip="Business unit">?</span></th>
      <th>Activity<span class="q" data-tip="Processing operation">?</span></th>
      <th>Data subjects<span class="q" data-tip="Whose data">?</span></th>
      <th>Data categories<span class="q" data-tip="Data types">?</span></th>
      <th>Purpose<span class="q" data-tip="Why processing">?</span></th>
      <th>System<span class="q" data-tip="Primary IT system">?</span></th>
      <th>Security measures<span class="q" data-tip="Key controls">?</span></th>
      <th>Lawful basis<span class="q" data-tip="GDPR Art.6 ground">?</span></th>
      <th>Retention<span class="q" data-tip="Storage period">?</span></th>
    </tr></thead>
  </template>

  <div id="scenarioContainer"></div>

  <div id="navBtnWrap">
    <button id="prevBtn" class="navBtn">Previous</button>
    <button id="nextBtn" class="navBtn">Next</button>
  </div>

  <script>
    /* --- Scenario data --- */
    const scenarios=[
      {type:'drag',title:'Salary payment',story:[
        'Finance uses <b>Workday</b> to calculate salaries. After approval a SEPA file is sent to the bank.',
        'The same dataset feeds tax filings. Records are kept up to seven years under national tax law.'
      ],entries:{department:'HR',activity:'Salary payment',subjects:'Employees',categories:'Name, address, bank details, salary',purpose:'Pay employees',system:'Workday',security:'Role‑based access, MFA, encrypted backups',basis:'Contract (Art.6 (1)(b))',retention:'5–7 years'}},
      {type:'drag',title:'Applicant process',story:[
        'Applications land in <b>Outlook</b> and flow into <b>Greenhouse</b>. Recruiters record interview scores.',
        'Rejected candidates are deleted after four weeks unless consent to keep data one year is given.'
      ],entries:{department:'HR',activity:'Applicant process',subjects:'Applicants',categories:'Contact details, CV, interview notes',purpose:'Recruit staff',system:'Greenhouse',security:'SSO, encrypted database',basis:'Contract (Art.6 (1)(b))',retention:'4 wks / 1 yr (consent)'}},
      {type:'drag',title:'Personnel file management',story:[
        '<b>SAP SuccessFactors</b> stores contracts and reviews. Managers add ratings annually.',
        'Files are kept two years post‑employment; ID copies five years for audits.'
      ],entries:{department:'HR',activity:'Personnel file management',subjects:'Employees',categories:'ID, contracts, reviews',purpose:'Employment admin',system:'SAP SuccessFactors',security:'Audit logs, TLS',basis:'Contract (Art.6 (1)(b))',retention:'2 yrs / 5 yrs ID'}},
      {type:'drag',title:'Employee satisfaction surveys',story:[
        'Quarterly surveys via <b>Qualtrics</b> capture engagement metrics.',
        'Raw answers are deleted after reporting; aggregated trends kept two years.'
      ],entries:{department:'HR',activity:'Satisfaction surveys',subjects:'Employees',categories:'Survey responses, click data',purpose:'Measure engagement',system:'Qualtrics',security:'HTTPS, anonymisation',basis:'Legitimate interest (Art.6 (1)(f))',retention:'2 years'}},
      {type:'drag',title:'Leave registration',story:[
        'Employees request leave in <b>Workday</b>. Balances sync to payroll.',
        'Leave data is stored two years after contract for dispute handling.'
      ],entries:{department:'HR',activity:'Leave registration',subjects:'Employees',categories:'Leave type, days, balance',purpose:'Track leave',system:'Workday',security:'HR role access',basis:'Contract (Art.6 (1)(b))',retention:'2 yrs post‑contract'}},
      {type:'input',title:'Sick leave registration',story:[
        'HR logs sick leave in Workday and sends required details to an external occupational‑health platform.',
        'Minimal data (name, contact, duration) is shared. Records retained two years after employment.'
      ],correct:{department:'HR',activity:'Sick leave registration',subjects:'Employees',categories:'Name, sick‑leave days, contact details',purpose:'Manage absence & OH referral',system:'Workday + OH portal',security:'TLS transfer, restricted HR access',basis:'Legal obligation (Art.6 (1)(c))',retention:'2 yrs post‑contract'}}
    ];

    const cols=['department','activity','subjects','categories','purpose','system','security','basis','retention'];
    const container=document.getElementById('scenarioContainer');

    /* --- Build scenarios --- */
    scenarios.forEach((sc,idx)=>{
      const i=idx+1;
      const block=document.createElement('div');block.className='scenario';block.id=`scenario${i}`;
      block.innerHTML=`<h2>Scenario ${i} – ${sc.title}</h2>`+sc.story.map(p=>`<p>${p}</p>`).join('');

      if(sc.type==='drag'){
        block.innerHTML+=`<table></table><div class='drag-container'></div>`;
        container.appendChild(block);
        const tbl=block.querySelector('table');tbl.appendChild(document.importNode(document.getElementById('theadTpl').content,true));
        const tr=document.createElement('tr');cols.forEach(c=>{const td=document.createElement('td');td.className='dropzone';td.dataset.col=c;tr.appendChild(td);});
        tbl.appendChild(document.createElement('tbody')).appendChild(tr);
        const dragBox=block.querySelector('.drag-container');
        Object.entries(sc.entries).forEach(([c,v])=>{const chip=document.createElement('div');chip.className='drag-item';chip.draggable=true;chip.dataset.col=c;chip.textContent=v;dragBox.appendChild(chip);});
      }else{
        block.innerHTML+=`<table></table><button class='navBtn' id='check${i}'>Check answers</button><div class='answerKey' id='key${i}'></div>`;
        container.appendChild(block);
        const tbl=block.querySelector('table');tbl.appendChild(document.importNode(document.getElementById('theadTpl').content,true));
        const tr=document.createElement('tr');cols.forEach(c=>{const td=document.createElement('td');td.innerHTML=`<input class='answer' id='${c}${i}'>`;tr.appendChild(td);});
        tbl.appendChild(document.createElement('tbody')).appendChild(tr);
        block.querySelector(`#check${i}`).onclick=()=>{const key=sc.correct;let html='<h3>Suggested answer</h3><ul>';Object.entries(key).forEach(([k,v])=>html+=`<li><b>${k.charAt(0).toUpperCase()+k.slice(1)}:</b> ${v}</li>`);html+='</ul>';block.querySelector(`#key${i}`).innerHTML=html;block.querySelector(`#key${i}`).style.display='block';};
      }
    });

    /* --- Shuffle chips & make draggable --- */
    document.querySelectorAll('.drag-container').forEach(box=>[...box.children].sort(()=>Math.random()-.5).forEach(n=>box.appendChild(n)));
    const makeDrag=el=>{el.addEventListener('dragstart',e=>{e.dataTransfer.setData('text',el.textContent);e.dataTransfer.setData('col',el.dataset.col);el.classList.add('dragging');});el.addEventListener('dragend',()=>el.classList.remove('dragging'));};
    document.querySelectorAll('.drag-item').forEach(makeDrag);

    document.querySelectorAll('.dropzone').forEach(zone=>{
      zone.addEventListener('dragover',e=>{e.preventDefault();zone.classList.add('blue');});
      zone.addEventListener('dragleave',()=>zone.classList.remove('blue'));
      zone.addEventListener('drop',e=>{e.preventDefault();zone.classList.remove('blue');const txt=e.dataTransfer.getData('text');const col=e.dataTransfer.getData('col');if(zone.dataset.col===col){const chip=document.createElement('div');chip.className='drag-item';chip.draggable=true;chip.dataset.col=col;chip.textContent=txt;makeDrag(chip);zone.appendChild(chip);document.querySelector('.dragging')?.remove();}else{zone.classList.add('red');setTimeout(()=>zone.classList.remove('red'),500);}});
    });

    /* --- Navigation --- */
    let current=1,total=scenarios.length;const prevBtn=document.getElementById('prevBtn');const nextBtn=document.getElementById('nextBtn');
    const show=scIdx=>{for(let k=1;k<=total;k++){document.getElementById(`scenario${k}`).style.display=k===scIdx?'block':'none';}prevBtn.disabled=scIdx===1;nextBtn.disabled=scIdx===total;};
    prevBtn.onclick=()=>{if(current>1){current--;show(current);window.scrollTo({top:0,behavior:'smooth'});}};
    nextBtn.onclick=()=>{if(current<total){current++;show(current);window.scrollTo({top:0,behavior:'smooth'});}};
    show(current);
  </script>
</body>
</html>

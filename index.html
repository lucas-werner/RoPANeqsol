<!DOCTYPE html>
<!-- RoPA Training Game – Security column has single correct option; RoPA button fully functional -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoPA Training Game</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap");
    :root{
      --dpo-green:#B4C800;
      --dpo-green-light:#D8E58A;
      --dpo-gray-dark:#3E3E3E;
      --dpo-gray:#4A4A4A;
      --dpo-gray-light:#6F6F6F;
      --bg:#f5f7f9;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Inter",sans-serif;background:var(--bg);color:var(--dpo-gray);padding:20px;min-height:100vh;}
    #logo{display:block;margin:20px auto 40px;width:120px;opacity:.9;}
    h1{text-align:center;font-weight:600;color:var(--dpo-gray-dark);margin-bottom:40px}
    h2{color:var(--dpo-gray-dark);font-weight:600;margin-bottom:8px}
    p{color:var(--dpo-gray-light);line-height:1.6;margin-bottom:14px}
    .scenario{background:#fff;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.05);padding:20px;margin-bottom:30px}
    table{width:100%;border-collapse:collapse;margin-bottom:20px}
    th,td{border:1px solid #e2e8f0;padding:12px 10px;min-height:60px;text-align:center;vertical-align:middle}
    th{background:#edf2f7;color:var(--dpo-gray-dark);font-weight:600;position:relative}
    .q{display:inline-block;background:var(--dpo-green);color:#fff;border-radius:50%;width:18px;height:18px;line-height:18px;font-size:12px;text-align:center;margin-left:6px;cursor:help}
    .q:hover::after{content:attr(data-tip);position:absolute;bottom:-6px;left:50%;transform:translate(-50%,100%);background:var(--dpo-gray-dark);color:#fff;padding:6px 8px;font-size:12px;border-radius:4px;white-space:nowrap;z-index:2000}
    .q:hover::before{content:"";position:absolute;bottom:2px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--dpo-gray-dark);z-index:2000}
    .dropzone{background:#fafafa;transition:background .3s}
    .dropzone.green{background:var(--dpo-green-light)}
    .dropzone.red{background:#feb2b2}
    .drag-container{display:flex;flex-wrap:wrap;gap:10px;padding:15px;background:#f7fafc;border:2px dashed #cbd5e0;border-radius:6px;min-height:100px}
    .drag-item{background:var(--dpo-green);color:#fff;padding:8px 12px;border-radius:20px;cursor:grab;font-size:14px;user-select:none;transition:transform .1s}
    .drag-item:active{transform:scale(.95);opacity:.85}
    input.answer{width:100%;border:none;background:#f0f4f8;height:100%;padding:6px;text-align:center}
    .answerKey{display:none;margin-top:20px}
    .navBtn{padding:12px 24px;font-size:16px;background:var(--dpo-green);color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background .3s}
    .navBtn:hover{background:#98b100}
    .navBtn:disabled{background:#a0aec0;cursor:not-allowed}
    #navBtnWrap{display:flex;justify-content:center;gap:20px;margin:30px 0 10px}
    #scoreBoard{text-align:center;font-weight:600;margin-bottom:60px;color:var(--dpo-gray-dark)}
    #overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);z-index:1350}
    .modal{position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);width:90%;max-width:800px;max-height:80vh;overflow:auto;background:#fff;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.15);padding:24px;z-index:1450}
    .hidden{display:none}
  </style>
</head>
<body>
  <img id="logo" src="https://www.adfiz.nl/media/4184/dpo-logo-vierkant.jpg" alt="DPO Consultancy logo" />
  <button id="ropaBtn" class="navBtn" style="position:fixed;top:20px;left:20px;z-index:1300">What is a RoPA?</button>
  <div id="overlay" class="hidden"></div>
  <div id="ropaModal" class="modal hidden">
    <h2>What is a RoPA?</h2>
    <p>A Record of Processing Activities (RoPA) documents personal-data processing and is required under Article 30 GDPR.</p>
    <button id="closeModal" class="navBtn" style="margin-top:20px">Close</button>
  </div>

  <h1>RoPA Practice – Payroll & HR Scenarios</h1>

  <template id="theadTpl">
    <thead>
      <tr>
        <th>Department<span class="q" data-tip="Business unit">?</span></th>
        <th>Activity<span class="q" data-tip="Processing operation">?</span></th>
        <th>Data subjects<span class="q" data-tip="Whose data">?</span></th>
        <th>Data categories<span class="q" data-tip="Data types">?</span></th>
        <th>Purpose<span class="q" data-tip="Why processing">?</span></th>
        <th>System<span class="q" data-tip="Primary IT system">?</span></th>
        <th>Security measures<span class="q" data-tip="Key controls">?</span></th>
        <th>Lawful basis<span class="q" data-tip="GDPR Art.6 ground">?</span></th>
        <th>Retention<span class="q" data-tip="Storage period">?</span></th>
      </tr>
    </thead>
  </template>

  <div id="scenarioContainer"></div>

  <div id="navBtnWrap">
    <button id="prevBtn" class="navBtn">Previous</button>
    <button id="nextBtn" class="navBtn" disabled>Next</button>
  </div>
  <div id="scoreBoard">Score <span id="score">0</span>/<span id="maxScore">0</span></div>

  <script>
    /* ----- Scenario data ----- */
    const scenarios = [
      {
        type:'drag',
        title:'Salary payment',
        story:[
          'Finance uses <b>Workday</b> to calculate salaries; a SEPA file is sent to the bank.',
          'Tax filings reuse the data; records kept seven years.'
        ],
        entries:{
          department:'HR',
          activity:'Salary payment',
          subjects:'Employees',
          categories:'Name, address, bank details, salary',
          purpose:'Pay employees',
          system:'Workday',
          security:'Role-based access; MFA; encrypted backups',
          basis:'Contract (Art.6(1)(b))',
          retention:'5–7 years'
        }
      },
      {
        type:'drag',
        title:'Applicant process',
        story:[
          'Applications move from <b>Outlook</b> to <b>Greenhouse</b>. Recruiters note scores.',
          'Rejected candidates deleted after four weeks unless consent for one-year retention is given.'
        ],
        entries:{
          department:'HR',
          activity:'Applicant process',
          subjects:'Applicants',
          categories:'Contact details, CV, interview notes',
          purpose:'Recruit staff',
          system:'Greenhouse',
          security:'SSO; encrypted DB',
          basis:'Contract (Art.6(1)(b))',
          retention:'4 wks / 1 yr (consent)'
        }
      },
      {
        type:'drag',
        title:'Personnel file management',
        story:[
          '<b>SAP SuccessFactors</b> stores contracts and reviews; managers add ratings annually.',
          'Files kept two years post-employment; ID copies five years.'
        ],
        entries:{
          department:'HR',
          activity:'Personnel file management',
          subjects:'Employees',
          categories:'ID, contracts, reviews',
          purpose:'Employment admin',
          system:'SAP SuccessFactors',
          security:'Audit logs; TLS',
          basis:'Contract (Art.6(1)(b))',
          retention:'2 yrs / 5 yrs ID'
        }
      },
      {
        type:'drag',
        title:'Employee satisfaction surveys',
        story:[
          'Quarterly surveys via <b>Qualtrics</b> capture engagement metrics.',
          'Raw answers deleted after reporting; trends kept two years.'
        ],
        entries:{
          department:'HR',
          activity:'Satisfaction surveys',
          subjects:'Employees',
          categories:'Survey responses, click data',
          purpose:'Measure engagement',
          system:'Qualtrics',
          security:'HTTPS; anonymisation',
          basis:'Legitimate interest (Art.6(1)(f))',
          retention:'2 years'
        }
      },
      {
        type:'drag',
        title:'Leave registration',
        story:[
          'Employees request leave in <b>Workday</b>. Balances sync to payroll.',
          'Leave data stored two years after contract.'
        ],
        entries:{
          department:'HR',
          activity:'Leave registration',
          subjects:'Employees',
          categories:'Leave type, days, balance',
          purpose:'Track leave',
          system:'Workday',
          security:'HR-role access',
          basis:'Contract (Art.6(1)(b))',
          retention:'2 yrs post-contract'
        }
      },
      {
        type:'input',
        title:'Sick leave registration',
        story:[
          'HR logs sick leave in Workday and sends details to an occupational-health platform.',
          'Minimal data shared. Records kept two years after employment.'
        ],
        correct:{
          department:'HR',
          activity:'Sick leave registration',
          subjects:'Employees',
          categories:'Name, sick-leave days, contact details',
          purpose:'Manage absence & OH referral',
          system:'Workday + OH portal',
          security:'TLS transfer; restricted HR access',
          basis:'Legal obligation (Art.6(1)(c))',
          retention:'2 yrs post-contract'
        }
      }
    ];

    const cols = ['department','activity','subjects','categories','purpose','system','security','basis','retention'];

    /* build distractor pools (except security) */
    const pool = {};
    cols.forEach(c => {
      pool[c] = scenarios.filter(s=>s.type==='drag').map(s=>s.entries[c]);
    });

    const container = document.getElementById('scenarioContainer');

    /* ----- Build scenarios ----- */
    scenarios.forEach((sc, idx) => {
      const i = idx + 1;
      const card = document.createElement('div');
      card.className = 'scenario';
      card.id = `scenario${i}`;
      card.innerHTML = `<h2>Scenario ${i} – ${sc.title}</h2>` + sc.story.map(t=>`<p>${t}</p>`).join('');

      if (sc.type === 'drag') {
        /* drag scenario */
        card.innerHTML += `<table></table><div class="drag-container"></div><p id="msg${i}" style="font-weight:600;color:var(--dpo-green);display:none">✔ Completed</p>`;
        container.appendChild(card);

        /* header row */
        const tbl = card.querySelector('table');
        tbl.appendChild(document.importNode(document.getElementById('theadTpl').content, true));
        const tr = document.createElement('tr');
        cols.forEach(c => {
          const td = document.createElement('td');
          td.className = 'dropzone';
          td.dataset.col = c;
          tr.appendChild(td);
        });
        tbl.appendChild(document.createElement('tbody')).appendChild(tr);

        /* build chip set */
        const dragBox = card.querySelector('.drag-container');
        const chips = [];
        cols.forEach(c => {
          const correct = sc.entries[c];
          if (c === 'security') {              /* only correct option */
            chips.push({text: correct, col: c});
            return;
          }
          const dist = [...pool[c].filter(v => v !== correct)];
          for (let k = 0; k < 2 && dist.length; k++) {
            const d = dist.splice(Math.floor(Math.random() * dist.length), 1)[0];
            chips.push({text:d, col:c});
          }
          chips.push({text: correct, col: c});
        });
        chips.sort(() => Math.random() - 0.5).forEach(ch => {
          const chip = document.createElement('div');
          chip.className = 'drag-item';
          chip.textContent = ch.text;
          chip.dataset.col = ch.col;
          chip.draggable = true;
          dragBox.appendChild(chip);
        });
      } else {
        /* input scenario */
        card.innerHTML += `<table></table><button class="navBtn" id="check${i}">Check answers</button><div class="answerKey" id="key${i}"></div><p id="msg${i}" style="font-weight:600;color:var(--dpo-green);display:none">✔ Completed</p>`;
        container.appendChild(card);

        const tbl = card.querySelector('table');
        tbl.appendChild(document.importNode(document.getElementById('theadTpl').content, true));
        const tr = document.createElement('tr');
        cols.forEach(c => {
          const td = document.createElement('td');
          td.innerHTML = `<input class="answer" id="${c}${i}">`;
          tr.appendChild(td);
        });
        tbl.appendChild(document.createElement('tbody')).appendChild(tr);
      }
    });

    /* ----- Drag events ----- */
    function addDragEvents() {
      document.querySelectorAll('.drag-item').forEach(el => {
        el.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text', el.textContent);
          e.dataTransfer.setData('col', el.dataset.col);
        });
      });
    }
    addDragEvents();

    window.addEventListener('load', () => {
      document.querySelectorAll('.drag-container').forEach(box => {
        [...box.children].sort(()=>Math.random()-.5).forEach(n=>box.appendChild(n));
      });
    });

    document.addEventListener('dragover', e => {
      if (e.target.classList.contains('dropzone')) {
        e.preventDefault();
        e.target.classList.add('green');
      }
    });
    document.addEventListener('dragleave', e => {
      if (e.target.classList.contains('dropzone')) e.target.classList.remove('green');
    });
    document.addEventListener('drop', e => {
      if (!e.target.classList.contains('dropzone')) return;
      e.preventDefault();
      e.target.classList.remove('green');
      const val = e.dataTransfer.getData('text');
      const col = e.dataTransfer.getData('col');
      if (col !== e.target.dataset.col) {
        e.target.classList.add('red');
        setTimeout(()=>e.target.classList.remove('red'), 600);
        return;
      }
      const scenarioIdx = [...document.querySelectorAll('.scenario')].indexOf(e.target.closest('.scenario'));
      if (val !== scenarios[scenarioIdx].entries[col]) {
        e.target.classList.add('red');
        setTimeout(()=>e.target.classList.remove('red'), 600);
        return;
      }
      e.target.textContent = val;
      checkComplete(scenarioIdx);
    });

    /* ----- Completion & score ----- */
    const done = Array(scenarios.length).fill(false);
    let score = 0;
    document.getElementById('maxScore').textContent = scenarios.length;

    function complete(idx) {
      if (done[idx]) return;
      done[idx] = true;
      document.getElementById(`msg${idx+1}`).style.display = 'block';
      score++;
      document.getElementById('score').textContent = score;
      if (current === idx) nextBtn.disabled = false;
    }

    function checkComplete(idx) {
      const card = document.getElementById(`scenario${idx+1}`);
      if ([...card.querySelectorAll('.dropzone')].every(z => z.textContent.trim())) complete(idx);
    }

    /* input checker */
    scenarios.forEach((sc, i) => {
      if (sc.type === 'input') {
        document.getElementById(`check${i+1}`).onclick = () => {
          if (done[i]) return;
          const key = sc.correct;
          let ok = true;
          cols.forEach(c => {
            const v = document.getElementById(`${c}${i+1}`).value.trim().toLowerCase();
            if (v !== key[c].toLowerCase()) ok = false;
          });
          document.getElementById(`key${i+1}`).style.display = 'block';
          if (ok) complete(i);
        };
      }
    });

    /* navigation */
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    let current = 0;
    function show(i) {
      document.querySelectorAll('.scenario').forEach((s,k)=>s.style.display = k === i ? 'block' : 'none');
      prevBtn.disabled = i === 0;
      nextBtn.disabled = !done[i];
      window.scrollTo({top:0,behavior:'smooth'});
    }
    show(0);
    prevBtn.onclick = () => { if (current>0) { current--; show(current);} };
    nextBtn.onclick = () => { if (done[current]) { current++; show(current);} };

    /* RoPA modal */
    const overlay = document.getElementById('overlay');
    const ropaModal = document.getElementById('ropaModal');
    document.getElementById('ropaBtn').onclick = () => { overlay.classList.remove('hidden'); ropaModal.classList.remove('hidden'); };
    document.getElementById('closeModal').onclick = () => { overlay.classList.add('hidden'); ropaModal.classList.add('hidden'); };
    overlay.onclick = document.getElementById('closeModal').onclick;
  </script>
</body>
</html>
